---
title: "Datacleaningcode"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r setup}
library(tidyverse)

non_numerics <- function(data=data_temp) {
  return(data %>% filter(is.na(as.numeric(ResultMeasureValue))) %>% 
      select(ResultMeasureValue,
         DetectionQuantitationLimitMeasure.MeasureValue,
         ResultMeasure.MeasureUnitCode,
         DetectionQuantitationLimitMeasure.MeasureUnitCode,
         ResultDetectionConditionText,
         ActivityBottomDepthHeightMeasure.MeasureValue,
         ActivityBottomDepthHeightMeasure.MeasureUnitCode,Obs_Id) %>% 
        drop_na(ResultMeasureValue))

}

`%notin%` <- Negate(`%in%`)


#here are functions
#for temperature

# resultconvert_celsius<-function(dat, variable, unit, out_unit) {
#   dat$ResultMeasureValue[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] <- (dat$ResultMeasureValue[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] -32)* 5/9
#   
# dat$ResultMeasure.MeasureUnitCode[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] <- out_unit
# 
# return(dat)
#   
# }
# 
# 
# detectconvert_celsius<-function(dat, variable, unit, out_unit) {
#   dat$DetectionQuantitationLimitMeasure.MeasureValue[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] <- (dat$DetectionQuantitationLimitMeasure.MeasureValue[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] * -32)*5/9
#   
# dat$DetectionQuantitationLimitMeasure.MeasureUnitCode[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] <- out_unit
# 
# return(dat)
#   
# }
# 
# #for all other conversions
# 
# resultconvert<-function(dat, variable, unit, out_unit, conv_factor) {
#   dat$ResultMeasureValue[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] <- dat$ResultMeasureValue[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] * conv_factor
#   
# dat$ResultMeasure.MeasureUnitCode[which(dat$CharacteristicName == variable & dat$ResultMeasure.MeasureUnitCode == unit)] <- out_unit
# 
# return(dat)
#   
# }
# 
# 
# detectconvert<-function(dat, variable, unit, out_unit, conv_factor) {
#   dat$DetectionQuantitationLimitMeasure.MeasureValue[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] <- dat$DetectionQuantitationLimitMeasure.MeasureValue[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] * conv_factor
#   
# dat$DetectionQuantitationLimitMeasure.MeasureUnitCode[which(dat$CharacteristicName == variable & dat$DetectionQuantitationLimitMeasure.MeasureUnitCode == unit)] <- out_unit
# 
# return(dat)
#   
# }



```


```{r noah-read}
file.path <- "~/Lottig Dropbox/Noah Lottig/CL_LAGOSUS_exports/LAGOSUS_LIMNO/US_NEW/raw_data/" #Noah
```


```{r kait-read}
file.path <-"" #kait
```


```{r arnab-read}
file.path <-"~/Lagos Limno/" #arnab
```


```{r read-files}

IDdatPull<-read.csv(paste0(file.path,"ID_alldata_1975_to_2020.csv"))
IDdatPull$State<-c("ID")
IDdatPull$Id_num<-c(seq(1:nrow(IDdatPull)))
IDdatPull <- IDdatPull %>% 
  unite('Obs_Id', c(State, Id_num), sep = "-", remove = FALSE)
names(IDdatPull)
summary(IDdatPull)

DEdatPull<-read.csv(paste0(file.path,"DE_alldata_1975_to_2020.csv"))
DEdatPull$State<-c("DE")
DEdatPull$Id_num<-c(seq(1:nrow(DEdatPull)))
DEdatPull <- DEdatPull %>% 
  unite('Obs_Id', c(State, Id_num), sep = "-", remove = FALSE)
names(DEdatPull)
summary(DEdatPull)

MDdatPull<-read.csv(paste0(file.path,"MD_alldata_1975_to_2020.csv"))
MDdatPull$State<-c("MD")
MDdatPull$Id_num<-c(seq(1:nrow(MDdatPull)))
MDdatPull <- MDdatPull %>% 
  unite('Obs_Id', c(State, Id_num), sep = "-", remove = FALSE)
names(MDdatPull)
summary(MDdatPull)

VAdatPull<-read.csv(paste0(file.path,"VA_alldata_1975_to_2020.csv"))
VAdatPull$State<-c("VA")
VAdatPull$Id_num<-c(seq(1:nrow(VAdatPull)))
VAdatPull <- VAdatPull %>% 
  unite('Obs_Id', c(State, Id_num), sep = "-", remove = FALSE)
names(VAdatPull)
summary(VAdatPull)

```


```{r}
allstates <- do.call("rbind", lapply(ls(pattern='datPull'),get))
#figure out how to autodelete files that contain datpull
rm(list=ls(pattern="datPull"))

#removing data that have Y's instead of keeping data that have N's
read.csv("list of unique parameters to remove.csv") -> remove_params #update this
data<- allstates[allstates$CharacteristicName %notin% remove_params$Unique.parameters,]
data <- data %>% 
  unite('Method_Id', c(ResultAnalyticalMethod.MethodIdentifierContext, ResultAnalyticalMethod.MethodIdentifier), sep = " ", remove = FALSE)

#get only locations that have a lagoslakeid
lagos_link <- read_csv("lagos_wqp_20210920.csv") %>% 
    rename(MonitoringLocationIdentifier = wqp_monitoringlocationidentifier)
data <- data %>% left_join(lagos_link) %>% drop_na(lagoslakeid)

rm(allstates)

str(data$ResultMeasureValue)
sum(is.na(data$ResultMeasureValue))
data1<-data %>% filter(!is.na(ResultMeasureValue))
data2<-data %>% filter(!is.na(DetectionQuantitationLimitMeasure.MeasureValue)) %>% filter(is.na(ResultMeasureValue))
data3<-rbind(data1, data2)
data<-data3
rm(data1, data2, data3)

#unique organizations
unique(data$OrganizationIdentifier) #19 organizations data
table(data$OrganizationFormalName) #tells us number of obvs in each organization
```


```{r Check-for-Activity-type}
#looking at activity type codes #getting rid of quality control vars

remove_activity <- unique(data$ActivityTypeCode)
activitytype_keep<-c("Quality Control Sample-Field Blank", "Quality Control Sample-Field Replicate", "Quality Control Field Replicate Msr/Obs")
remove_activity <- remove_activity[!remove_activity %in% activitytype_keep]
remove_activity

data<-data[which(data$ActivityTypeCode %notin% activitytype_keep),]
unique(data$ActivityTypeCode)
```


```{r }
#manually checking these columns to see if these is data we keep or can drop

unique(data$SubjectTaxonomicName) #expected it to be na - to make sure nothing we need is in there
unique(data$SampleTissueAnatomyName) #also NA's - expected
unique(data$ActivityMediaSubdivisionName)
#only keeping subdivision name with surface water and NA's - dropping everything else 
data<-data %>% filter(ActivityMediaSubdivisionName == "Surface Water" | is.na(ActivityMediaSubdivisionName))
unique(data$ActivityMediaSubdivisionName)

unique(data$ResultStatusIdentifier)
data <- data %>% filter(ResultStatusIdentifier != "Rejected")

unique(data$ResultValueTypeName)
data<-data %>% filter(ResultValueTypeName == "Actual" | is.na(ResultValueTypeName))
data <- data %>% filter(ResultAnalyticalMethod.MethodName !="Computation by NWIS algorithm" | is.na(ResultAnalyticalMethod.MethodName))

unique(data$ResultDetectionConditionText)
#filtered out vars we don't need in resultsdetection condition text - did it in multistep because R doesn't handle multiple OR statements well

data<-data %>% filter(ResultDetectionConditionText != "Systematic Contamination" | is.na(ResultDetectionConditionText))
data<-data %>% filter(is.na(ResultDetectionConditionText) | ResultDetectionConditionText != "Not Reported")
unique(data$ResultDetectionConditionText)



unique(data$ResultSampleFractionText)
data<-data %>% filter(is.na(ResultSampleFractionText) | ResultSampleFractionText != "Bed Sediment")
data<-data %>% filter(is.na(ResultSampleFractionText) | ResultSampleFractionText != "Recoverable")
data<-data %>% filter(is.na(ResultSampleFractionText) | ResultSampleFractionText != "Acid Soluble")
data<-data %>% filter(is.na(ResultSampleFractionText) | ResultSampleFractionText != "Total Recoverable")
unique(data$ResultSampleFractionText)

data<-data %>% select(-ActivityMediaName, -ActivityMediaSubdivisionName, -ActivityStartTime.TimeZoneCode, -ActivityEndTime.Time, -ActivityEndTime.TimeZoneCode, -SampleAquifer, -HydrologicCondition, -HydrologicEvent, -SubjectTaxonomicName, -SampleTissueAnatomyName, -LaboratoryName, -AnalysisStartDate, -PreparationStartDate)

#depthheight conversions 
unique(data$ActivityDepthHeightMeasure.MeasureUnitCode) 
data$ActivityDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityDepthHeightMeasure.MeasureUnitCode == "ft", data$ActivityDepthHeightMeasure.MeasureValue*0.3048, data$ActivityDepthHeightMeasure.MeasureValue)
data$ActivityDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityDepthHeightMeasure.MeasureUnitCode == "feet", data$ActivityDepthHeightMeasure.MeasureValue*0.3048, data$ActivityDepthHeightMeasure.MeasureValue)
data$ActivityDepthHeightMeasure.MeasureUnitCode[!is.na(data$ActivityDepthHeightMeasure.MeasureUnitCode)]<-"m"

unique(data$ResultDepthHeightMeasure.MeasureUnitCode) 
data$ResultDepthHeightMeasure.MeasureValue<-ifelse(data$ResultDepthHeightMeasure.MeasureUnitCode == "ft", data$ResultDepthHeightMeasure.MeasureValue*0.3048, data$ResultDepthHeightMeasure.MeasureValue)
data$ResultDepthHeightMeasure.MeasureValue<-ifelse(data$ResultDepthHeightMeasure.MeasureUnitCode == "feet", data$ResultDepthHeightMeasure.MeasureValue*0.3048, data$ResultDepthHeightMeasure.MeasureValue)
data$ResultDepthHeightMeasure.MeasureUnitCode[!is.na(data$ResultDepthHeightMeasure.MeasureUnitCode)]<-"m"

unique(data$ActivityTopDepthHeightMeasure.MeasureUnitCode) 
data$ActivityTopDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityTopDepthHeightMeasure.MeasureUnitCode == "ft", data$ActivityTopDepthHeightMeasure.MeasureValue*0.3048, data$ActivityTopDepthHeightMeasure.MeasureValue)
data$ActivityTopDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityTopDepthHeightMeasure.MeasureUnitCode == "feet", data$ActivityTopDepthHeightMeasure.MeasureValue*0.3048, data$ActivityTopDepthHeightMeasure.MeasureValue)
data$ActivityTopDepthHeightMeasure.MeasureUnitCode[!is.na(data$ActivityTopDepthHeightMeasure.MeasureUnitCode)]<-"m"



unique(data$ActivityBottomDepthHeightMeasure.MeasureUnitCode) #all in m - no conversion needed
data$ActivityBottomDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityBottomDepthHeightMeasure.MeasureUnitCode == "ft", data$ActivityBottomDepthHeightMeasure.MeasureValue*0.3048, data$ActivityBottomDepthHeightMeasure.MeasureValue)
data$ActivityBottomDepthHeightMeasure.MeasureValue<-ifelse(data$ActivityBottomDepthHeightMeasure.MeasureUnitCode == "feet", data$ActivityBottomDepthHeightMeasure.MeasureValue*0.3048, data$ActivityBottomDepthHeightMeasure.MeasureValue)
data$ActivityBottomDepthHeightMeasure.MeasureUnitCode[!is.na(data$ActivityBottomDepthHeightMeasure.MeasureUnitCode)]<-"m"




#check
unique(data$ActivityDepthHeightMeasure.MeasureUnitCode)
unique(data$ResultDepthHeightMeasure.MeasureUnitCode)
unique(data$ActivityTopDepthHeightMeasure.MeasureUnitCode)
unique(data$ActivityBottomDepthHeightMeasure.MeasureUnitCode)

```


```{r backupvalues}

###creating new columns to preserve original pulled data

data$source_parameter<- data$CharacteristicName
data$source_value<- data$ResultMeasureValue
data$source_unit <- data$ResultMeasure.MeasureUnitCode
data$detectionlimit_legacy<- data$DetectionQuantitationLimitMeasure.MeasureValue
data$detectionlimit_unit_legacy<- data$DetectionQuantitationLimitMeasure.MeasureUnitCode

vars2process <- unique(data$CharacteristicName) #only once for first occurrence
rm(allstates)
rm(lagos_link)
rm(remove_params)
```


```{r depth}
#Depth
abbrev <- "depth"
lagos_name <- "Depth"
lagos_unit <- "m"
dataset_name <-"depth"

params<-c("Depth, data-logger (non-ported)", "Depth", "Depth, data-logger (ported)", "Depth, bottom")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
#done
```


```{r secchi}
abbrev <- "secchi"
lagos_name <- "Secchi"
lagos_unit <- "m"
dataset_name <-"secchi"

params<-c("Depth, Secchi disk depth","Depth, Secchi disk depth (choice list)") #values for secchi
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

{
#notes for processing non-numerics
#have to be able to assign a value and units to either result measure value and/or detection limit value to process
temp2 <- temp %>% 
  filter(grepl(">",ResultMeasureValue,fixed=TRUE)) %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue))
#extract Values
vals <- gsub("[^0-9.-]", "", temp2$ResultMeasureValue)
data_temp$DetectionQuantitationLimitMeasure.MeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Greater Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- NA

temp2 <- temp %>% 
  filter(ResultMeasureValue=="On Bottom") %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue)) %>% 
  filter(!is.na(ActivityBottomDepthHeightMeasure.MeasureValue))
vals <- temp2$ActivityBottomDepthHeightMeasure.MeasureValue
data_temp$DetectionQuantitationLimitMeasure.MeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Greater Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- NA

#check temp again to make sure everything is fixed that can be fixed
  }

source("unit_conversions.R")
```


```{r calcium}

abbrev <- "Calcium"
lagos_name <- "Calcium, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"Calcium_dissolved"

vars2process
params<-c("Calcium")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")



```

```{r aluminum-total}
abbrev <- "tAl"
lagos_name <- "Aluminum, total"
lagos_unit <- "ug/l"
dataset_name <-"Aluminum_total"

vars2process
params<-c("Aluminum")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```


```{r aluminum-dissolved}
abbrev <- "dAl"
lagos_name <- "Aluminum, dissolved"
lagos_unit <- "ug/l"
dataset_name <-"Aluminum_dissolved"

vars2process
params<-c("Aluminum")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r mercury-total}
abbrev <- "tMe"
lagos_name <- "Mercury, total"
lagos_unit <- "ng/l"
dataset_name <-"Mercury_total"

vars2process
params<-c("Mercury")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r mercury-dissolved}

abbrev <- "dMe"
lagos_name <- "Mercury, dissolved"
lagos_unit <- "ng/l"
dataset_name <-"Mercury_dissolved"

vars2process
params<-c("Mercury")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")


```

```{r methylmercury-total}
#commented out because sample fraction does not have a total - only has suspended and dissolved

# abbrev <- "mMe"
# lagos_name <- "Methylmercury"
# lagos_unit <- "ng/l"
# dataset_name <-"Methylmercury"
# 
# vars2process
# params<-c("Methylmercury(1+)")
# vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
# vars2process #check if any new varables to inlcude
# 
# data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
# 
# unique(data_temp$ResultSampleFractionText)
# data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
# unique(data_temp$ResultSampleFractionText)
# 
# ###create dataset to check for non numeric objects in dataset
# temp <- non_numerics()
# #has no data so far
# source("unit_conversions.R")
```

```{r methylmercury-dissolved}

abbrev <- "dmMe"
lagos_name <- "Methylmercury, dissolved"
lagos_unit <- "ng/l"
dataset_name <-"Methylmercury_dissolved"

vars2process
params<-c("Methylmercury(1+)")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r Magnesium}
abbrev <- "Magnesium"
lagos_name <- "Magnesium, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"Magnesium_dissolved"

vars2process
params<-c("Magnesium")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r selenium-total}
abbrev <- "tSe"
lagos_name <- "Selenium, total"
lagos_unit <- "ug/l"
dataset_name <-"Selenium_total"

vars2process
params<-c("Selenium")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")


```

```{r selenium-dissolved}
abbrev <- "dSe"
lagos_name <- "Selenium, dissolved"
lagos_unit <- "ug/l"
dataset_name <-"selenium_dissolved"

vars2process
params<-c("Selenium")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r arsenic-total}
abbrev <- "tArsenic"
lagos_name <- "Arsenic, total"
lagos_unit <- "ug/l"
dataset_name <-"Arsenic_total"

vars2process
params<-c("Arsenic")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r arsenic-dissolved}
abbrev <- "dArsenic"
lagos_name <- "Arsenic, dissolved"
lagos_unit <- "ug/l"
dataset_name <-"Arsenic_dissolved"

vars2process
params<-c("Arsenic")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r atrazine-dissolved}

abbrev <- "Atrazine"
lagos_name <- "Atrazine, dissolved"
lagos_unit <- "ug/l"
dataset_name <-"Atrazine_dissolved"

vars2process
params<-c("Atrazine")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r ecoli #/100ml}

abbrev <- "Ecoli"
lagos_name <- "E. coli"
lagos_unit <- "#/100ml"
dataset_name <-"E.coli_100ml"

vars2process
params<-c("Escherichia coli")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

unique(data_temp$ResultMeasure.MeasureUnitCode)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r ecoli MPN}

abbrev <- "Ecoli_MPN"
lagos_name <- "E. coli-MPN"
lagos_unit <- "MPN"
dataset_name <-"E.coli_MPN"

vars2process
params<-c("Escherichia coli")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

unique(data_temp$ResultMeasure.MeasureUnitCode)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r ecoli CFU}

abbrev <- "Ecoli_CFU"
lagos_name <- "E. coli-CFU"
lagos_unit <- "CFU"
dataset_name <-"E.coli_CFU"

vars2process
params<-c("Escherichia coli")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

unique(data_temp$ResultMeasure.MeasureUnitCode)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r chloride}
abbrev <- "Chloride"
lagos_name <- "Chloride, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"Chloride_dissolved"

vars2process
params<-c("Chloride")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r oxygen}
abbrev <- "DO"
lagos_name <- "Oxygen, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"Oxygen_dissolved"

vars2process
params<-c("Dissolved oxygen (DO)", "Oxygen")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
#no need to filter DO based on fraction
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- "Less Than"

source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)

```

```{r chlorophyll}

abbrev <- "Chla"
lagos_name <- "Chlorophyll a"
lagos_unit <- "ug/l"
dataset_name <-"Chlorophyll_a"

vars2process
params<-c("Chlorophyll a, corrected for pheophytin", "Chlorophyll a", "Chlorophyll a, uncorrected for pheophytin")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
#no need to filter DO based on fraction
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

temp2 <- temp %>% 
  filter(grepl("<",ResultMeasureValue,fixed=TRUE)) %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue))
#extract Values
vals <- gsub("[^0-9.-]", "", temp2$ResultMeasureValue)
data_temp$DetectionQuantitationLimitMeasure.MeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Less Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals

temp <- non_numerics()
unique(temp$ResultMeasureValue)

temp2 <- temp %>% 
  filter(grepl("<",ResultMeasureValue,fixed=TRUE))  
vals <- gsub("[^0-9.-]", "", temp2$ResultMeasureValue)
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Less Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals

temp <- non_numerics()


source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)

```

```{r pH}

abbrev <- "pH"
lagos_name <- "pH, equilibrated"
lagos_unit <- "pH"
dataset_name <-"pH_equilibrated"

vars2process
params<-c("pH")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r temperature}
abbrev <- "wtemp"
lagos_name <- "Temperature"
lagos_unit <- "deg C"
dataset_name <-"wtemp"

params<-c("Temperature, water")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

unique(data_temp$ResultMeasure.MeasureUnitCode)
unique(data_temp$DetectionQuantitationLimitMeasure.MeasureUnitCode)

data_temp$ResultMeasureValue <- as.numeric(data_temp$ResultMeasureValue)

#convert result measure value
data_temp$ResultMeasureValue[which(data_temp$ResultMeasure.MeasureUnitCode=="deg F")] <- 
  (data_temp$ResultMeasureValue[which(data_temp$ResultMeasure.MeasureUnitCode=="deg F")]-32)*(5/9)
data_temp$ResultMeasure.MeasureUnitCode[which(data_temp$ResultMeasure.MeasureUnitCode=="deg F")] <- "deg C"

#convert detection limit
```

```{r sulfate}
#sulfate is reported as SO4
abbrev <- "so4"
lagos_name <- "Sulfate, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"so4"

vars2process
params<-c("Sulfate as SO4",
          "Sulfate as S",
          "Sulfate", "Sulfur Sulfate")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()
unique(temp$ResultMeasureValue)
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- "Less Than"

source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)
```

```{r turbidity}
abbrev <- "Turbidity"
lagos_name <- "Turbidity"
lagos_unit <- "NTU"
dataset_name <-"Turbidity"

vars2process
params<-c("Turbidity")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r conductivity}
abbrev <- "Conductivity"
lagos_name <- "Conductivity"
lagos_unit <- "uS/cm"
dataset_name <-"Conductivity"

vars2process
params<-c("Conductivity", "Specific conductance")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")

```

```{r total-carbon}
abbrev <- "tCarbon"
lagos_name <- "Carbon, total organic"
lagos_unit <- "mg/l"
dataset_name <-"Carbon_total organic"

vars2process
params<-c("Carbon", "Organic carbon")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r total-dissolved-carbon}
abbrev <- "tdCarbon"
lagos_name <- "Carbon, dissolved organic"
lagos_unit <- "mg/l"
dataset_name <-"Carbon_dissolved organic"

vars2process
params<-c("Carbon", "Organic carbon")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r alkalinity}

abbrev <- "Alkalinity"
lagos_name <- "Alkalinity"
lagos_unit <- "ueq/l"
dataset_name <-"Alkalinity"

vars2process
params<-c("Alkalinity, total", "Alkalinity, Carbonate as CaCO3", "Alkalinity", "Alkalinity, carbonate")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")


```

```{r TSS}
abbrev <- "tss"
lagos_name <- "Solids, total suspended"
lagos_unit <- "mg/l"
dataset_name <-"Solids_total suspended"

vars2process
params<-c("Total suspended solids", "Total dissolved solids")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)

data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total" | ResultSampleFractionText == "Suspended")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- "Less Than"
vals <- gsub("[^0-9.-]", "", temp$ResultMeasureValue)
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- vals



source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)

```

```{r Salinity}
abbrev <- "Salinity"
lagos_name <- "Salinity"
lagos_unit <- "ppt"
dataset_name <-"Salinity"

vars2process
params<-c("Salinity")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r color-true}
abbrev <- "TColor"
lagos_name <- "Color, true"
lagos_unit <- "PCU"
dataset_name <-"Color_true"

vars2process
params<-c("True color")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r color-apparent}
abbrev <- "ApparColor"
lagos_name <- "Color, apparent"
lagos_unit <- "PCU"
dataset_name <-"Color_apparent"

vars2process
params<-c("Color")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if any new varables to inlcude

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 

###create dataset to check for non numeric objects in dataset
temp <- non_numerics()

source("unit_conversions.R")
```

```{r dissolved-inorganic-phosphorus}
abbrev <- "dip"
lagos_name <- "Phosphorus, soluable reactive orthophosphate"
lagos_unit <- "ug/l"
dataset_name <-"dip"

vars2process
params<-c("Orthophosphate", 
          "Orthophosphate as P", 
          "Phosphate-phosphorus",
          "Phosphate-phosphorus as P",
          "Phosphorus")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved" | ResultSampleFractionText=="Filterable" | ResultSampleFractionText=="Inorganic")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()
unique(temp$ResultMeasureValue)

temp2 <- temp %>% filter(grepl("<",temp$ResultMeasureValue,fixed=TRUE)==TRUE) %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue))

data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- "Less Than"

source("unit_conversions.R")
```

```{r phosphorus-total}
abbrev <- "tp"
lagos_name <- "Phosphorus, total"
lagos_unit <- "ug/l"
dataset_name <-"tp"

vars2process
params<-c("Phosphorus",
          "Phosphate-phosphorus",
          "Total Phosphorus, mixed forms")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()
unique(temp$ResultMeasureValue)

temp2 <- temp %>% filter(grepl("<",temp$ResultMeasureValue,fixed=TRUE)==TRUE)
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Less Than"

source("unit_conversions.R")
```

```{r phosphorus-total-dissolved}
abbrev <- "tp"
lagos_name <- "Phosphorus, total dissolved"
lagos_unit <- "ug/l"
dataset_name <-"tdp"

params<-c("Phosphorus",
          "Phosphate-phosphorus",
          "Total Phosphorus, mixed forms")

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved" | ResultSampleFractionText=="Filterable")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()
unique(temp$ResultMeasureValue)

source("unit_conversions.R")
```

```{r TKN-kjeldahl-total }
abbrev <- "kn"
lagos_name <- "Nitrogen, total Kjeldahl"
lagos_unit <- "ug/l"
dataset_name <-"tkn"

vars2process
params<-c("Total Kjeldahl nitrogen",
          "Kjeldahl nitrogen")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()
unique(temp$ResultMeasureValue)
vals <- gsub("[^0-9.-]", "", temp$ResultMeasureValue)
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- "Less Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp$Obs_Id)] <- vals

source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)
```

```{r TDKN-kjeldahl-dissolved}
abbrev <- "kn"
lagos_name <- "Nitrogen, total dissolved Kjeldahl"
lagos_unit <- "ug/l"
dataset_name <-"dkn"

params<-c("Total Kjeldahl nitrogen",
          "Kjeldahl nitrogen")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

source("unit_conversions.R")
data_temp_temp_notes
rm(data_temp_temp_notes)
```



```{r nitrogen-total}
abbrev <- "tn"
lagos_name <- "Nitrogen, total"
lagos_unit <- "ug/l"
dataset_name <-"tn"

vars2process
params<-c("Total Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)",
          "Nutrient-nitrogen",
          "Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)",
          "Total Nitrogen, mixed forms",
          "Nitrogen")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Total")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

unique(temp$ResultMeasureValue)
temp2 <- temp %>% filter(grepl("<",temp$ResultMeasureValue,fixed=TRUE)==TRUE) %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue))
vals <- gsub("[^0-9.-]", "", temp2$ResultMeasureValue)
data_temp$DetectionQuantitationLimitMeasure.MeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- vals
data_temp$ResultDetectionConditionText[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- "Less Than"
data_temp$ResultMeasureValue[which(data_temp$Obs_Id %in% temp2$Obs_Id)] <- NA

source("unit_conversions.R")
```

```{r total-dissolved-nitrogen}
abbrev <- "tn" #this should stay the same as tn
lagos_name <- "Nitrogen, total dissolved"
lagos_unit <- "ug/l"
dataset_name <-"tdn"

#remember this should get pulled down from TN
params<-c("Total Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)",
          "Nutrient-nitrogen",
          "Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)",
          "Total Nitrogen, mixed forms",
          "Nitrogen")

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved" | ResultSampleFractionText=="Filterable")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

source("unit_conversions.R")
```

```{r Ammonia-ammonium}

abbrev <- "NH3NH4" 
lagos_name <- "Nitrogen, NH4"
lagos_unit <- "ug/l"
dataset_name <-"NH3NH4"

vars2process
params<-c("Ammonium", "Ammonia", "Ammonia-nitrogen as N", "Ammonia and ammonium", "Ammonia-nitrogen", "Ammonia as NH3")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

source("unit_conversions.R")

```

```{r NO2-N}

abbrev <- "NO2" 
lagos_name <- "Nitrogen, nitrite (NO2)"
lagos_unit <- "ug/l"
dataset_name <-"NO2"

vars2process
params<-c("Nitrite")
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process



data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

source("unit_conversions.R")

```

```{r NO2NO3-N}
abbrev <- "NO3"
lagos_name <- "Nitrogen, nitrite (NO2) + nitrate (NO3)"
lagos_unit <- "ug/l"
dataset_name <-"no3"

params<-c("Inorganic nitrogen (nitrate and nitrite)", 
          "Inorganic nitrogen (nitrate and nitrite) as N", 
          "Nitrate", "Nitrate as N","Nitrate + Nitrite",
          "Nitrogen",
          "Total Nitrogen, mixed forms",
          "Total Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)"
          )
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #che

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)

###create dataset to check for non numeric objects in dataset
temp<-non_numerics()

###create dataset to check for non numeric objects in dataset
temp<-data_temp %>% filter(is.na(as.numeric(ResultMeasureValue)))  #checks for non numeric values in result measure value - if NA's not losing any other data - can change #391 NA's - can change
unique(temp$ResultMeasureValue)

temp2 <- temp %>% filter(grepl("<",temp$ResultMeasureValue,fixed=TRUE)==TRUE) %>% 
  filter(is.na(DetectionQuantitationLimitMeasure.MeasureValue))
#if there were na values in detection would need to transfer over obs values to detection limits

#overwrite < with NA
data_temp <- data_temp %>% 
  mutate(ResultMeasureValue = ifelse(grepl("<",ResultMeasureValue,fixed=TRUE),NA,ResultMeasureValue))

source("unit_conversions.R")
```

```{r Silica}
abbrev <- "Si"
lagos_name <- "Silica, dissolved"
lagos_unit <- "mg/l"
dataset_name <-"silica"

params <- c("Silica", "Silicate", "Silicon") 
vars2process<-vars2process[! vars2process %in% params] #remove grab samples from list
vars2process #check if there are any missed variable

data_temp<-data[data$CharacteristicName%in%params,] #want to match all records to the vector we created above 
unique(data_temp$ResultSampleFractionText)
data_temp <- data_temp %>% filter(ResultSampleFractionText=="Dissolved")
unique(data_temp$ResultSampleFractionText)


###create dataset to check for non numeric objects in dataset
temp<- non_numerics() #checks for non numeric values in result measure value - if NA's not losing any other data - can change #391 NA's - can change

unique(temp$ResultMeasureValue)

source("unit_conversions.R")
```

```{r}
vars2process
data_all <- do.call("rbind", lapply(ls(pattern='^data_'),get))
data_all$ResultMeasureValue<-data_all$Converted
data_all$DetectionQuantitationLimitMeasure.MeasureValue<-data_all$Converted_dl
data_all<-data_all %>% select(-Converted, -Converted_dl)
write.csv(data_all, file = "alldata.csv", row.names = FALSE)


```


